<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Library Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e1e8ed;
            border-radius: 15px;
            background: #f8fafc;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 500;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            background: #f1f3ff;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            background: #e8edff;
            border-color: #5a6fd8;
        }

        .file-upload.dragover {
            background: #e8edff;
            border-color: #5a6fd8;
            transform: scale(1.02);
        }

        .library-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .book-card {
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .book-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .book-author {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-style: italic;
        }

        .loan-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }

        .loan-info.returned {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .book-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .search-box {
            width: 100%;
            margin-bottom: 20px;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
        }

        .search-box:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Personal Library Tracker</h1>
            <p>Keep track of your books, loans, and reading collection</p>
        </div>

        <div class="main-content">
            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalBooks">0</div>
                    <div>Total Books</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="loanedOut">0</div>
                    <div>Currently Loaned</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="availableBooks">0</div>
                    <div>Available</div>
                </div>
            </div>

            <!-- Import Section -->
            <div class="section">
                <h2><span class="icon">üìä</span> Import from Google Sheets</h2>
                <div class="file-upload" id="fileUpload">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üìÅ</div>
                    <p><strong>Click to upload</strong> or drag and drop your Google Sheets file (Excel format)</p>
                    <p style="margin-top: 10px; color: #7f8c8d;">Supported formats: .xlsx, .xls</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                </div>
                <div style="margin-top: 15px; padding: 15px; background: #e8f4f8; border-radius: 8px; color: #2c3e50;">
                    <strong>Expected columns:</strong> Title, Author First Name, Author Last Name, Loaned Out (Yes/No), Loan Date, Loaned To, Returned (Yes/No)
                </div>
            </div>

            <!-- Add Book Section -->
            <div class="section">
                <h2><span class="icon">‚ûï</span> Add New Book</h2>
                <form id="bookForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="title">Book Title *</label>
                            <input type="text" id="title" required>
                        </div>
                        <div class="form-group">
                            <label for="authorFirst">Author First Name *</label>
                            <input type="text" id="authorFirst" required>
                        </div>
                        <div class="form-group">
                            <label for="authorLast">Author Last Name *</label>
                            <input type="text" id="authorLast" required>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="isLoaned">
                        <label for="isLoaned">Currently loaned out</label>
                    </div>

                    <div id="loanDetails" style="display: none; margin-top: 20px;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="loanDate">Loan Date</label>
                                <input type="date" id="loanDate">
                            </div>
                            <div class="form-group">
                                <label for="loanedTo">Loaned To</label>
                                <input type="text" id="loanedTo" placeholder="Person's name">
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="isReturned">
                            <label for="isReturned">Has been returned</label>
                        </div>
                    </div>

                    <button type="submit" class="btn" style="margin-top: 20px;">
                        <span class="icon">üìö</span> Add Book
                    </button>
                </form>
            </div>

            <!-- Library Display -->
            <div class="section">
                <h2><span class="icon">üìñ</span> Your Library</h2>
                <input type="text" id="searchBox" class="search-box" placeholder="Search by title, author, or person loaned to...">
                
                <div class="button-group" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-small" onclick="filterBooks('all')">All Books</button>
                    <button class="btn btn-small" onclick="filterBooks('available')">Available</button>
                    <button class="btn btn-small" onclick="filterBooks('loaned')">Currently Loaned</button>
                    <button class="btn btn-secondary btn-small" onclick="exportToExcel()">Export to Excel</button>
                </div>

                <div id="libraryContainer" class="library-grid">
                    <div class="empty-state">
                        <h3>No books in your library yet</h3>
                        <p>Add your first book using the form above or import from a spreadsheet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let library = JSON.parse(localStorage.getItem('personalLibrary')) || [];
        let currentFilter = 'all';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            displayLibrary();
            updateStats();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Form submission
            document.getElementById('bookForm').addEventListener('submit', addBook);
            
            // Loan checkbox toggle
            document.getElementById('isLoaned').addEventListener('change', function() {
                const loanDetails = document.getElementById('loanDetails');
                loanDetails.style.display = this.checked ? 'block' : 'none';
                
                if (!this.checked) {
                    document.getElementById('loanDate').value = '';
                    document.getElementById('loanedTo').value = '';
                    document.getElementById('isReturned').checked = false;
                }
            });

            // Search functionality
            document.getElementById('searchBox').addEventListener('input', function() {
                displayLibrary(this.value);
            });

            // File upload
            const fileUpload = document.getElementById('fileUpload');
            const fileInput = document.getElementById('fileInput');

            fileUpload.addEventListener('click', () => fileInput.click());
            fileUpload.addEventListener('dragover', handleDragOver);
            fileUpload.addEventListener('drop', handleFileDrop);
            fileInput.addEventListener('change', handleFileSelect);
        }

        function addBook(e) {
            e.preventDefault();
            
            const book = {
                id: Date.now(),
                title: document.getElementById('title').value.trim(),
                authorFirst: document.getElementById('authorFirst').value.trim(),
                authorLast: document.getElementById('authorLast').value.trim(),
                isLoaned: document.getElementById('isLoaned').checked,
                loanDate: document.getElementById('loanDate').value,
                loanedTo: document.getElementById('loanedTo').value.trim(),
                isReturned: document.getElementById('isReturned').checked
            };

            library.push(book);
            saveLibrary();
            displayLibrary();
            updateStats();
            
            // Reset form
            document.getElementById('bookForm').reset();
            document.getElementById('loanDetails').style.display = 'none';
        }

        function displayLibrary(searchTerm = '') {
            const container = document.getElementById('libraryContainer');
            let filteredBooks = library;

            // Apply search filter
            if (searchTerm) {
                filteredBooks = library.filter(book => 
                    book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    book.authorFirst.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    book.authorLast.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (book.loanedTo && book.loanedTo.toLowerCase().includes(searchTerm.toLowerCase()))
                );
            }

            // Apply category filter
            if (currentFilter === 'available') {
                filteredBooks = filteredBooks.filter(book => !book.isLoaned || book.isReturned);
            } else if (currentFilter === 'loaned') {
                filteredBooks = filteredBooks.filter(book => book.isLoaned && !book.isReturned);
            }

            if (filteredBooks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>${searchTerm ? 'No books found' : 'No books in your library yet'}</h3>
                        <p>${searchTerm ? 'Try a different search term' : 'Add your first book using the form above'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredBooks.map(book => `
                <div class="book-card">
                    <div class="book-title">${book.title}</div>
                    <div class="book-author">by ${book.authorFirst} ${book.authorLast}</div>
                    
                    ${book.isLoaned ? `
                        <div class="loan-info ${book.isReturned ? 'returned' : ''}">
                            <strong>${book.isReturned ? 'Previously loaned' : 'Currently loaned'}</strong><br>
                            ${book.loanDate ? `Date: ${new Date(book.loanDate).toLocaleDateString()}` : ''}<br>
                            ${book.loanedTo ? `To: ${book.loanedTo}` : ''}
                            ${book.isReturned ? '<br><span style="color: #28a745;">‚úì Returned</span>' : ''}
                        </div>
                    ` : ''}
                    
                    <div class="book-actions">
                        <button class="btn btn-small" onclick="editLoanStatus(${book.id})">
                            ${book.isLoaned && !book.isReturned ? 'Mark Returned' : 'Loan Out'}
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="editBook(${book.id})">Edit</button>
                        <button class="btn btn-secondary btn-small" onclick="deleteBook(${book.id})" style="background: #e74c3c;">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function filterBooks(filter) {
            currentFilter = filter;
            displayLibrary(document.getElementById('searchBox').value);
            
            // Update button styles
            document.querySelectorAll('.button-group .btn').forEach(btn => {
                btn.style.background = btn.textContent.toLowerCase().includes(filter) || (filter === 'all' && btn.textContent === 'All Books') ? 
                    'linear-gradient(135deg, #667eea, #764ba2)' : 
                    'linear-gradient(135deg, #95a5a6, #7f8c8d)';
            });
        }

        function editLoanStatus(id) {
            const book = library.find(b => b.id === id);
            if (!book) return;

            if (book.isLoaned && !book.isReturned) {
                // Mark as returned
                book.isReturned = true;
            } else {
                // Loan out
                const loanedTo = prompt('Who are you loaning this book to?');
                if (loanedTo !== null) {
                    book.isLoaned = true;
                    book.loanedTo = loanedTo;
                    book.loanDate = new Date().toISOString().split('T')[0];
                    book.isReturned = false;
                }
            }

            saveLibrary();
            displayLibrary();
            updateStats();
        }

        function editBook(id) {
            const book = library.find(b => b.id === id);
            if (!book) return;

            const newTitle = prompt('Enter new title:', book.title);
            if (newTitle !== null) book.title = newTitle;

            const newAuthorFirst = prompt('Enter author first name:', book.authorFirst);
            if (newAuthorFirst !== null) book.authorFirst = newAuthorFirst;

            const newAuthorLast = prompt('Enter author last name:', book.authorLast);
            if (newAuthorLast !== null) book.authorLast = newAuthorLast;

            saveLibrary();
            displayLibrary();
        }

        function deleteBook(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                library = library.filter(book => book.id !== id);
                saveLibrary();
                displayLibrary();
                updateStats();
            }
        }

        function updateStats() {
            const total = library.length;
            const loaned = library.filter(book => book.isLoaned && !book.isReturned).length;
            const available = total - loaned;

            document.getElementById('totalBooks').textContent = total;
            document.getElementById('loanedOut').textContent = loaned;
            document.getElementById('availableBooks').textContent = available;
        }

        function saveLibrary() {
            localStorage.setItem('personalLibrary', JSON.stringify(library));
        }

        // File handling functions
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleFileDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function processFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    importBooks(jsonData);
                } catch (error) {
                    alert('Error reading file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function importBooks(data) {
            let imported = 0;
            
            data.forEach(row => {
                if (row.Title && row['Author First Name'] && row['Author Last Name']) {
                    const book = {
                        id: Date.now() + Math.random(),
                        title: row.Title,
                        authorFirst: row['Author First Name'],
                        authorLast: row['Author Last Name'],
                        isLoaned: row['Loaned Out'] === 'Yes' || row['Loaned Out'] === true,
                        loanDate: row['Loan Date'] || '',
                        loanedTo: row['Loaned To'] || '',
                        isReturned: row.Returned === 'Yes' || row.Returned === true
                    };
                    
                    library.push(book);
                    imported++;
                }
            });
            
            if (imported > 0) {
                saveLibrary();
                displayLibrary();
                updateStats();
                alert(`Successfully imported ${imported} books!`);
            } else {
                alert('No valid books found in the file. Please check the column headers.');
            }
        }

        function exportToExcel() {
            if (library.length === 0) {
                alert('No books to export!');
                return;
            }

            const exportData = library.map(book => ({
                'Title': book.title,
                'Author First Name': book.authorFirst,
                'Author Last Name': book.authorLast,
                'Loaned Out': book.isLoaned ? 'Yes' : 'No',
                'Loan Date': book.loanDate,
                'Loaned To': book.loanedTo,
                'Returned': book.isReturned ? 'Yes' : 'No'
            }));

            const worksheet = XLSX.utils.json_to_sheet(exportData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Library');
            
            XLSX.writeFile(workbook, 'my_library.xlsx');
        }
    </script>
</body>
</html>